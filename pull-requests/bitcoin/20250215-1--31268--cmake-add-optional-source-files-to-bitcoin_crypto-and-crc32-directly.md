# [#31268](https://github.com/bitcoin/bitcoin/pull/31268) cmake: add optional source files to bitcoin_crypto and crc32 directly

PR by @purpleKarrot

## Context

In the `bitcoin_crypto` library, there are a variety of special SHA256 implementations for different processor architectures. In the context of this PR, the CMake build system tests whether the build environment supports AVX2 (Intel/AMD x86), SSE4/SSE4.1 (Intel) or X86_SHANI / ARM_SHANI and compiles each of these source files into an independent library which is statically linked into the `bitcoin_crypto` target.

The PR proposes to simplify the process by adding these specialized source files directly into the `bitcoin_crypto` target when they are supported. This takes advantage of CMake to reduce the number of libraries generated by the build process, and the resultant static linking of them into the final `bitcoin_crypto` library.

There is some discussion as to whether this approach was harder to reason about, but it feels pretty straightforward to me, even as a newbie. The arguments against seemed to be protecting future maintainers from misunderstanding CMake's treatment of compiler options' priority.

## Personal

I learned a lot reviewing this PR. Addressing the deep internals of the `bitcoin_crypto` library, it was actually pretty over my head at the beginning. After following along well enough to understand the proposed changes, I felt comfortable enough to practice participation by adding and `ACK`, knowing it probably served little value other than bumping it to the attention of maintainers.
